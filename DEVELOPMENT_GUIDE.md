# دليل التطوير - مشروع نسمة برزان

## نظرة عامة

مشروع نسمة برزان هو موقع شركة تجارية ثنائي اللغة (عربي/إنجليزي) مع لوحة تحكم إدارية كاملة لإدارة المحتوى والمشاريع والصور.

## البنية التقنية

### Frontend
- **React 19** - مكتبة واجهة المستخدم
- **TypeScript** - لغة البرمجة المكتوبة
- **Tailwind CSS 4** - إطار عمل التصميم
- **tRPC** - للاتصال بين Frontend و Backend

### Backend
- **Express.js** - خادم الويب
- **tRPC** - نظام الـ API
- **Drizzle ORM** - للتعامل مع قاعدة البيانات

### قاعدة البيانات
- **MySQL** - قاعدة البيانات الرئيسية
- الجداول:
  - `users` - المستخدمين والمسؤولين
  - `site_content` - محتوى الموقع (ثنائي اللغة)
  - `projects` - المشاريع
  - `images` - الصور المرفوعة

### المصادقة
- **Manus OAuth** - نظام المصادقة الرسمي (للإنتاج)
- **Dev Bypass Mode** - وضع التطوير لتجاوز المصادقة (للتطوير فقط)

---

## إعداد البيئة

### المتطلبات
- Node.js 22.13.0
- pnpm
- MySQL

### التثبيت

```bash
# سحب المشروع
gh repo clone DROPIDEA0/NESMA-BARAZAN
cd NESMA-BARAZAN

# تثبيت المتطلبات
pnpm install

# إعداد قاعدة البيانات
sudo mysql -e "CREATE DATABASE IF NOT EXISTS nesma_barzan;"

# إنشاء الجداول
pnpm db:push
```

### ملف البيئة (.env)

تم إنشاء ملف `.env` يحتوي على الإعدادات التالية:

```env
# Database
DATABASE_URL=mysql://root@localhost:3306/nesma_barzan

# OAuth Configuration
OAUTH_SERVER_URL=https://oauth.manus.im
VITE_APP_ID=nesma-barzan-dev
VITE_OAUTH_PORTAL_URL=https://oauth.manus.im

# Security
JWT_SECRET=development-secret-key-change-in-production

# Storage Configuration (S3-compatible)
BUILT_IN_FORGE_API_URL=https://storage.example.com
BUILT_IN_FORGE_API_KEY=development-key

# Development Mode - Bypass OAuth (only for development!)
DEV_BYPASS_AUTH=true
```

---

## وضع التطوير (Dev Bypass Mode)

### ما هو؟

وضع التطوير هو ميزة خاصة تم إضافتها للسماح بالوصول إلى لوحة التحكم بدون الحاجة لنظام OAuth الخارجي في بيئة التطوير.

### كيف يعمل؟

عند تفعيل `DEV_BYPASS_AUTH=true` في ملف `.env`، يقوم النظام بـ:

1. إنشاء مستخدم إداري افتراضي في قاعدة البيانات:
   - **OpenID**: `dev-admin-local`
   - **الاسم**: Dev Admin
   - **البريد**: admin@dev.local
   - **الدور**: admin

2. تسجيل دخول تلقائي لهذا المستخدم في كل طلب HTTP

3. تجاوز نظام OAuth بالكامل

### ملاحظة أمنية مهمة ⚠️

**لا تستخدم هذا الوضع في الإنتاج أبداً!** هذا الوضع مخصص فقط لبيئة التطوير. في الإنتاج:
- احذف أو عطّل `DEV_BYPASS_AUTH`
- استخدم نظام OAuth الرسمي
- قم بتغيير `JWT_SECRET` إلى مفتاح آمن

### التعديلات التقنية

تم تعديل الملفات التالية لإضافة وضع التطوير:

#### 1. `server/_core/env.ts`
```typescript
export const ENV = {
  // ... متغيرات أخرى
  devBypassAuth: process.env.DEV_BYPASS_AUTH === "true",
};
```

#### 2. `server/_core/context.ts`
تم إضافة منطق لإنشاء مستخدم إداري افتراضي عند تفعيل وضع التطوير.

---

## تشغيل المشروع

### وضع التطوير

```bash
pnpm dev
```

سيعمل المشروع على: `http://localhost:3000`

### الوصول للوحة التحكم

بعد تشغيل المشروع، يمكنك الوصول إلى:

- **الموقع الرئيسي**: `http://localhost:3000`
- **لوحة التحكم**: `http://localhost:3000/admin`

في وضع التطوير (مع `DEV_BYPASS_AUTH=true`)، ستتمكن من الوصول مباشرة إلى لوحة التحكم بدون تسجيل دخول.

---

## لوحة التحكم

### الصفحات المتاحة

#### 1. الصفحة الرئيسية (Dashboard)
- عرض إحصائيات سريعة
- إجراءات سريعة للمهام الشائعة

#### 2. إدارة المحتوى
- تعديل نصوص الموقع
- دعم اللغتين العربية والإنجليزية
- تنظيم المحتوى حسب الأقسام

#### 3. إدارة المشاريع
- إضافة مشاريع جديدة
- تعديل المشاريع الموجودة
- حذف المشاريع
- رفع صور للمشاريع
- ترتيب المشاريع

#### 4. إدارة الصور
- رفع صور جديدة
- إضافة نص بديل (Alt Text) باللغتين
- عرض جميع الصور المرفوعة
- حذف الصور

---

## البنية الملفية

```
NESMA-BARAZAN/
├── client/                 # Frontend (React)
│   ├── src/
│   │   ├── components/    # المكونات المشتركة
│   │   ├── pages/         # صفحات الموقع
│   │   │   ├── admin/    # صفحات لوحة التحكم
│   │   │   └── ...       # صفحات الموقع العامة
│   │   ├── hooks/        # React Hooks المخصصة
│   │   └── const.ts      # الثوابت
│   └── ...
├── server/                # Backend (Express + tRPC)
│   ├── _core/            # الملفات الأساسية
│   │   ├── context.ts   # سياق tRPC
│   │   ├── env.ts       # متغيرات البيئة
│   │   ├── oauth.ts     # نظام OAuth
│   │   └── ...
│   ├── db.ts            # عمليات قاعدة البيانات
│   ├── routers.ts       # مسارات API
│   └── ...
├── drizzle/              # قاعدة البيانات
│   └── schema.ts        # تعريف الجداول
├── .env                  # متغيرات البيئة
└── package.json
```

---

## الأوامر المتاحة

```bash
# تشغيل وضع التطوير
pnpm dev

# بناء المشروع للإنتاج
pnpm build

# تشغيل الإنتاج
pnpm start

# تحديث قاعدة البيانات
pnpm db:push

# إنشاء migration جديد
pnpm db:generate
```

---

## التطوير المستقبلي

### مقترحات للتحسين

1. **نظام رفع الصور**
   - حالياً يستخدم S3-compatible storage
   - يمكن إضافة دعم لخدمات أخرى مثل Cloudinary

2. **محرر نصوص غني**
   - إضافة محرر WYSIWYG لإدارة المحتوى
   - دعم التنسيق والوسائط المتعددة

3. **نظام الأدوار والصلاحيات**
   - حالياً يوجد دورين فقط: user و admin
   - يمكن إضافة أدوار أكثر تفصيلاً

4. **التحليلات والإحصائيات**
   - إضافة تتبع الزوار
   - تقارير عن أداء الموقع

5. **النسخ الاحتياطي**
   - نظام تلقائي للنسخ الاحتياطي
   - استعادة البيانات

---

## الدعم والمساعدة

للمزيد من المعلومات أو المساعدة:
- راجع ملفات المشروع في GitHub
- تحقق من سجلات الخادم في Terminal
- استخدم أدوات المطور في المتصفح

---

## الترخيص

هذا المشروع ملك لشركة نسمة برزان التجارية.
